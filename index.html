<!doctype html>
<html lang="vi">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Chi·∫øc N√≥n K√¨ Di·ªáu - To√†n Di·ªán</title>
  <style>
    :root { 
      --bg: linear-gradient(135deg, #ffffff, #f5f5f5, #efefef); 
      --panel: #ffffff; 
      --text: #1a1a1a; 
      --ok: #00d4ff; 
      --bad: #ff006e; 
      --warn: #ffb703; 
      --line: #e0e0e0; 
      --accent: #00a8cc;
      --accent2: #ff006e;
      --accent3: #ffb703;
    }
    * { box-sizing:border-box; }
    body { 
      margin:0; 
      font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; 
      background: var(--bg);
      color: var(--text); 
      overflow-x: hidden;
      min-height: 100vh;
    }
    
    /* Navigation Bar */
    nav { 
      background: rgba(255, 255, 255, 0.95); 
      backdrop-filter: blur(10px);
      padding: 15px; 
      display: flex; 
      justify-content: center; 
      gap: 15px; 
      border-bottom: 2px solid var(--accent); 
      position: sticky; 
      top: 0; 
      z-index: 100;
      box-shadow: 0 4px 20px rgba(0, 168, 204, 0.2);
    }
    nav button { 
      padding: 12px 25px; 
      border-radius: 25px; 
      border: 2px solid var(--line); 
      background: transparent;
      color: var(--text); 
      cursor: pointer; 
      font-weight: bold;
      transition: all 0.3s ease;
      font-size: 15px;
    }
    nav button:hover { 
      border-color: var(--accent);
      color: var(--accent);
      transform: translateY(-2px);
    }
    nav button.active { 
      background: linear-gradient(135deg, var(--accent), var(--accent2));
      border-color: white; 
      box-shadow: 0 0 20px rgba(0, 168, 204, 0.5);
      color: white;
    }

    .page { display: none; padding: 30px; animation: fadeIn 0.4s ease; }
    .page.active { display: block; }
    @keyframes fadeIn { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }

    /* Control Page */
    .control-grid { display: grid; grid-template-columns: 1fr 350px; gap: 25px; }
    .wheel-box { 
      background: rgba(255, 255, 255, 0.9);
      backdrop-filter: blur(10px);
      border-radius: 25px; 
      padding: 25px; 
      text-align: center; 
      border: 2px solid var(--accent);
      box-shadow: 0 8px 30px rgba(0, 168, 204, 0.15);
    }
    canvas { max-width: 100%; height: auto; border-radius: 50%; }
    .sidebar { display: flex; flex-direction: column; gap: 15px; }
    
    /* Team Page */
    .teams-container { 
      display: grid; 
      grid-template-columns: repeat(auto-fit, minmax(280px, 1fr)); 
      gap: 20px;
      margin-top: 20px;
    }
    .team-card { 
      background: rgba(255, 255, 255, 0.9);
      backdrop-filter: blur(10px);
      border: 2px solid var(--accent);
      border-radius: 20px; 
      padding: 20px; 
      text-align: center;
      transition: all 0.3s ease;
      box-shadow: 0 8px 25px rgba(0, 168, 204, 0.1);
    }
    .team-card:hover {
      transform: translateY(-5px);
      border-color: var(--accent2);
      box-shadow: 0 12px 35px rgba(255, 0, 110, 0.15);
    }
    .team-card h2 {
      margin: 0 0 15px 0;
      font-size: 24px;
      color: var(--accent);
    }
    .score-big { 
      font-size: 56px; 
      font-weight: 900; 
      background: linear-gradient(135deg, var(--accent), var(--accent2));
      -webkit-background-clip: text;
      -webkit-text-fill-color: transparent;
      margin: 15px 0; 
    }
    .btn-score { 
      padding: 8px 15px; 
      font-size: 16px; 
      margin: 0 5px; 
      cursor: pointer;
      border: none;
      border-radius: 10px;
      background: rgba(0, 168, 204, 0.15);
      color: var(--accent);
      font-weight: bold;
      transition: all 0.2s ease;
    }
    .btn-score:hover {
      background: var(--accent);
      color: white;
      transform: scale(1.05);
    }

    /* Effects Container */
    .effects-section {
      margin-top: 20px;
      padding-top: 15px;
      border-top: 1px solid var(--line);
    }
    .effects-section h4 {
      color: var(--accent3);
      margin: 10px 0;
      font-size: 14px;
    }
    .effects-grid {
      display: grid;
      grid-template-columns: 1fr 1fr;
      gap: 8px;
    }
    .effect-btn {
      padding: 8px;
      font-size: 12px;
      border: 1px solid var(--line);
      border-radius: 8px;
      cursor: pointer;
      background: rgba(255, 183, 3, 0.1);
      color: var(--accent3);
      transition: all 0.2s ease;
      font-weight: bold;
    }
    .effect-btn:hover {
      background: var(--accent3);
      color: white;
      transform: scale(1.05);
    }
    .effect-btn.active {
      background: var(--accent3);
      color: white;
      border-color: var(--accent3);
    }
    .effect-badge {
      display: inline-block;
      padding: 4px 10px;
      margin: 3px;
      border-radius: 15px;
      font-size: 11px;
      font-weight: bold;
      background: rgba(255, 183, 3, 0.15);
      color: var(--accent3);
      border: 1px solid var(--accent3);
    }

    /* Question Page */
    .q-display { 
      max-width: 900px; 
      margin: 40px auto; 
      background: rgba(255, 255, 255, 0.9);
      backdrop-filter: blur(10px);
      padding: 40px; 
      border-radius: 25px; 
      border: 2px solid var(--accent); 
      text-align: center;
      box-shadow: 0 8px 30px rgba(0, 168, 204, 0.15);
    }
    .q-text { 
      font-size: 32px; 
      font-weight: bold; 
      color: var(--accent); 
      margin-bottom: 30px; 
    }
    .options { 
      display: grid; 
      grid-template-columns: 1fr 1fr; 
      gap: 20px; 
    }
    .opt { 
      background: rgba(224, 224, 224, 0.4);
      padding: 20px; 
      border-radius: 15px; 
      font-size: 20px; 
      border: 2px solid var(--line);
      cursor: pointer;
      transition: all 0.3s ease;
      color: var(--text);
    }
    .opt:hover {
      border-color: var(--accent);
      transform: translateY(-3px);
      box-shadow: 0 5px 15px rgba(0, 168, 204, 0.2);
    }
    .opt.correct { 
      background: linear-gradient(135deg, var(--ok), var(--accent)) !important;
      color: white;
      border-color: white;
      box-shadow: 0 0 20px rgba(0, 168, 204, 0.5);
    }

    /* Utils */
    .log { 
      height: 200px; 
      overflow-y: auto; 
      background: rgba(224, 224, 224, 0.3);
      padding: 12px; 
      border-radius: 12px; 
      font-size: 13px; 
      margin-top: 15px; 
      text-align: left;
      border: 1px solid var(--line);
      color: var(--text);
    }
    .log div { margin: 5px 0; color: var(--accent); }
    .btn-main { 
      background: linear-gradient(135deg, var(--ok), var(--accent2));
      color: white; 
      padding: 15px; 
      width: 100%; 
      font-size: 20px; 
      border-radius: 15px; 
      margin-top: 10px;
      border: none;
      cursor: pointer;
      font-weight: bold;
      transition: all 0.3s ease;
      box-shadow: 0 4px 15px rgba(0, 168, 204, 0.3);
    }
    .btn-main:hover {
      transform: translateY(-2px);
      box-shadow: 0 6px 20px rgba(0, 168, 204, 0.5);
    }
    .btn-main:disabled {
      opacity: 0.5;
      cursor: not-allowed;
    }
    button { font-family: inherit; }

    /* Modal Popup */
    .modal {
      display: none;
      position: fixed;
      z-index: 1000;
      left: 0;
      top: 0;
      width: 100%;
      height: 100%;
      background-color: rgba(0, 0, 0, 0.6);
      backdrop-filter: blur(6px);
      animation: fadeIn 0.2s ease;
    }
    .modal.show {
      display: flex;
      align-items: stretch;
      justify-content: center;
    }
    .modal-content {
      background: linear-gradient(135deg, rgba(255,255,255,0.98), rgba(250,250,250,0.98));
      backdrop-filter: none;
      border-radius: 0;
      padding: 28px;
      width: 100%;
      height: 100%;
      max-width: none;
      border: none;
      box-shadow: none;
      overflow-y: auto;
      display: flex;
      flex-direction: column;
      gap: 18px;
      align-items: stretch;
    }
    /* Centered inner container to keep question area proportioned */
    .modal-inner {
      max-width: 1100px;
      width: 100%;
      margin: 0 auto;
      display: flex;
      flex-direction: column;
      gap: 18px;
      flex: 1 1 auto;
      justify-content: center;
    }
    /* Position close button top-right */
    .modal-header {
      display: flex;
      justify-content: flex-start;
      align-items: center;
      gap: 12px;
      margin-bottom: 8px;
      padding-bottom: 6px;
      border-bottom: 1px solid var(--line);
      position: relative;
    }
    .close-btn {
      position: absolute;
      right: 28px;
      top: 14px;
      background: var(--bad);
      color: white;
      border: none;
      width: 40px;
      height: 40px;
      border-radius: 50%;
      font-size: 20px;
      cursor: pointer;
      display: flex;
      align-items: center;
      justify-content: center;
      transition: all 0.15s ease;
      z-index: 30;
    }
    @keyframes slideUp {
      from {
        opacity: 0;
        transform: translateY(20px);
      }
      to {
        opacity: 1;
        transform: translateY(0);
      }
    }
    .modal-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      gap: 12px;
      margin-bottom: 8px;
      padding-bottom: 6px;
      border-bottom: 1px solid var(--line);
    }
    .modal-header h2 {
      margin: 0;
      color: var(--accent);
      font-size: 22px;
      font-weight: 700;
    }
    .modal-timer {
      position: absolute;
      right: 86px; /* room for close button */
      top: 18px;
      font-size: 20px;
      font-weight: 800;
      color: var(--accent);
      background: rgba(0,0,0,0.02);
      padding: 6px 10px;
      border-radius: 10px;
    }
    /* duplicate block removed to avoid conflicts */
    }
    .close-btn:hover {
      transform: scale(1.07);
      box-shadow: 0 0 12px rgba(255, 0, 110, 0.35);
    }
    .modal-question {
      text-align: center;
      margin: 4px 0 6px 0;
    }
    .modal-question .q-text {
      font-size: 44px;
      margin-bottom: 22px;
      color: var(--accent);
      line-height: 1.2;
      font-weight: 800;
    }
    .modal-options {
      display: grid;
      grid-template-columns: 1fr 1fr;
      gap: 20px;
    }
    .modal-opt {
      background: rgba(224, 224, 224, 0.45);
      padding: 24px;
      border-radius: 14px;
      font-size: 20px;
      border: 2px solid var(--line);
      cursor: pointer;
      transition: all 0.22s ease;
      text-align: left;
      color: var(--text);
      min-height: 90px;
      display: flex;
      align-items: center;
    }
    .modal-opt:hover {
      border-color: var(--accent);
      transform: translateY(-4px);
      box-shadow: 0 8px 30px rgba(0, 168, 204, 0.12);
    }
    .modal-opt.correct {
      background: linear-gradient(135deg, var(--ok), var(--accent)) !important;
      color: white;
      border-color: white;
      box-shadow: 0 0 20px rgba(0, 168, 204, 0.25);
    }
    .modal-buttons {
      display: flex;
      gap: 18px;
      justify-content: center;
      align-items: center;
      margin-top: 6px;
    }
    .modal-btn {
      padding: 18px 26px;
      border-radius: 14px;
      border: none;
      font-size: 18px;
      cursor: pointer;
      font-weight: 800;
      transition: all 0.18s ease;
      flex: 1;
      min-width: 180px;
    }
    .modal-btn-primary {
      background: linear-gradient(135deg, var(--ok), var(--accent2));
      color: white;
    }
    .modal-btn-primary:hover { transform: translateY(-2px); box-shadow: 0 6px 20px rgba(0, 168, 204, 0.25); }
    .modal-btn-secondary {
      background: rgba(0, 168, 204, 0.12);
      color: var(--accent);
    }
    .modal-btn-secondary:hover { background: var(--accent); color: white; }
    .modal-btn:disabled { opacity: 0.55; cursor: not-allowed; }
    .modal-opt {
      background: rgba(224, 224, 224, 0.4);
      padding: 15px;
      border-radius: 12px;
      font-size: 16px;
      border: 2px solid var(--line);
      cursor: pointer;
      transition: all 0.3s ease;
      text-align: left;
      color: var(--text);
    }
    .modal-opt:hover {
      border-color: var(--accent);
      transform: translateY(-3px);
      box-shadow: 0 5px 15px rgba(0, 168, 204, 0.2);
    }
    .modal-opt.correct {
      background: linear-gradient(135deg, var(--ok), var(--accent)) !important;
      color: white;
      border-color: white;
      box-shadow: 0 0 20px rgba(0, 168, 204, 0.5);
    }
    .modal-buttons {
      display: flex;
      gap: 10px;
      justify-content: center;
    }
    .modal-btn {
      padding: 18px 26px;
      border-radius: 14px;
      border: none;
      font-size: 18px;
      cursor: pointer;
      font-weight: 800;
      transition: all 0.18s ease;
    }
    .modal-btn-primary {
      background: linear-gradient(135deg, var(--ok), var(--accent2));
      color: white;
      flex: 1;
    }
    .modal-btn-primary:hover {
      transform: translateY(-2px);
      box-shadow: 0 6px 20px rgba(0, 168, 204, 0.5);
    }
    .modal-btn-secondary {
      background: rgba(0, 168, 204, 0.15);
      color: var(--accent);
      min-width: 100px;
    }
    .modal-btn-secondary:hover {
      background: var(--accent);
      color: white;
    }

    /* Extra scaling for very large screens */
    @media (min-width: 1400px) {
      .modal-question .q-text { font-size: 56px; }
      .modal-opt { font-size: 24px; padding: 28px; min-height: 120px; }
      .modal-btn { font-size: 20px; padding: 22px 36px; }
      .modal-timer { font-size: 22px; right: 120px; }
    }
  </style> 
</head>
<body>

<nav>
  <button onclick="showPage('control')" id="btn-control" class="active">üéÆ ƒêI·ªÄU KHI·ªÇN</button>
  <button onclick="showPage('teams')" id="btn-teams">üìä B·∫¢NG ƒêI·ªÇM</button>
  <button onclick="showPage('questions')" id="btn-questions">‚ùì C√ÇU H·ªéI</button>
</nav>

<div id="page-control" class="page active">
  <div class="control-grid">
    <div class="wheel-box">
      <canvas id="wheel" width="700" height="700"></canvas>
      <button class="btn-main" id="btnSpin">SPIN (QUAY)</button>
      <h2 id="resultDisplay" style="color:var(--warn)">K·∫æT QU·∫¢: ---</h2>
    </div>
    
    <div class="sidebar">
      <div class="team-card" style="margin-bottom: 15px;">
        <h3>Tr·∫°ng th√°i: <span id="statusText" style="color:var(--ok)">S·∫¥N S√ÄNG</span></h3>
        <p>L∆∞·ª£t ƒë·ªôi: <b id="turnName">Ch∆∞a buzz</b></p>
      </div>
      <div class="team-card">
        <h3>Nh·∫≠t k√Ω</h3>
        <div id="log" class="log"></div>
      </div>
      <button onclick="resetGame()" style="background:var(--bad); color:white; margin-top:10px; padding:10px; width:100%; border-radius:10px; border:none; cursor:pointer;">RESET GAME</button>
    </div>
  </div>
</div>

<div id="page-teams" class="page">
  <h1 style="text-align:center">B·∫¢NG ƒêI·ªÇM HI·ªÜN T·∫†I</h1>
  <div class="teams-container" id="teamsList"></div>
</div>

<div id="page-questions" class="page">
  <div class="q-display">
    <div id="qNum" style="color:var(--muted)">C√¢u h·ªèi s·ªë 1</div>
    <div id="qText" class="q-text">Vui l√≤ng quay n√≥n ƒë·ªÉ b·∫Øt ƒë·∫ßu c√¢u h·ªèi</div>
    <div id="qOptions" class="options"></div>
    <div style="margin-top:30px; display:flex; justify-content: center; gap:10px;">
        <button onclick="changeQ(-1)">C√¢u tr∆∞·ªõc</button>
        <button onclick="revealAnswer()" style="background:var(--ok); color:white;">M·ªü ƒë√°p √°n</button>
        <button onclick="changeQ(1)">C√¢u ti·∫øp</button>
    </div>
  </div>
</div>

<!-- Question Popup Modal -->
<div id="questionModal" class="modal">
  <div class="modal-content">
    <div class="modal-header">
      <h2 id="modalQNum">C√¢u h·ªèi s·ªë 1</h2>
      <div id="modalTimer" class="modal-timer">Th·ªùi gian: <span id="modalTimerDisplay">10</span>s</div>
      <button class="close-btn" onclick="closeQuestionModal()">√ó</button>
    </div>

    <div class="modal-inner">
      <div class="modal-question">
        <div id="modalQText" class="q-text"></div>
        <div id="modalQOptions" class="modal-options"></div>
      </div>

      <div class="modal-buttons">
        <button id="modalStartBtn" class="modal-btn modal-btn-secondary" onclick="startModalTimer()">B·∫ÆT ƒê·∫¶U</button>
        <button id="modalRevealBtn" class="modal-btn modal-btn-primary" onclick="revealAnswerModal()">M·ªû ƒê√ÅP √ÅN</button>
        <button id="modalNextBtn" class="modal-btn modal-btn-secondary" onclick="nextQuestionModal()">C√ÇU TI·∫æP ‚Üí</button>
      </div>
    </div>
  </div>
</div>

<script>
/** D·ªÆ LI·ªÜU H·ªÜ TH·ªêNG **/
const CELLS = [
  { label:"+10", color: "#FF6B6B", val: 10 }, { label:"+20", color: "#FF8E72", val: 20 },
  { label:"+30", color: "#FFA500", val: 50 }, { label:"-10", color: "#FFD93D", val: -10 },
  { label:"X2", color: "#6BCB77", val: 0 }, { label:"+10", color: "#4D96FF", val: 10 },
  { label:"+20", color: "#5F4BE6", val: 20 }, { label:"T·∫§N C√îNG", color: "#E535AB", val: -999 },
  { label:"+10", color: "#FF006E", val: 10 }, { label:"PH√íNG TH·ª¶", color: "#00D4FF", val: 0 },
  { label:"C∆Ø·ªöP L∆Ø·ª¢T", color: "#FB5607", val: 0 }
];

const QUESTIONS = [
  {
    t: "Gia ƒë√¨nh trong th·ªùi k·ª≥ qu√° ƒë·ªô l√™n CNXH ƒë∆∞·ª£c xem l√† g√¨?",
    o: [
      "ƒê∆°n v·ªã kinh t·∫ø ƒë·ªôc l·∫≠p",
      "T·∫ø b√†o c·ªßa x√£ h·ªôi",
      "T·ªï ch·ª©c ch√≠nh tr·ªã",
      "Thi·∫øt ch·∫ø nh√† n∆∞·ªõc"
    ],
    a: 1
  },
  {
    t: "Ch·ª©c nƒÉng n√†o KH√îNG ph·∫£i ch·ª©c nƒÉng c∆° b·∫£n c·ªßa gia ƒë√¨nh?",
    o: [
      "Ch·ª©c nƒÉng t√°i s·∫£n xu·∫•t con ng∆∞·ªùi",
      "Ch·ª©c nƒÉng kinh t·∫ø",
      "Ch·ª©c nƒÉng gi√°o d·ª•c",
      "Ch·ª©c nƒÉng qu·∫£n l√Ω nh√† n∆∞·ªõc"
    ],
    a: 3
  },
  {
    t: "Gia ƒë√¨nh x√£ h·ªôi ch·ªß nghƒ©a ƒë∆∞·ª£c x√¢y d·ª±ng tr√™n c∆° s·ªü n√†o?",
    o: [
      "Quan h·ªá huy·∫øt th·ªëng",
      "Quan h·ªá kinh t·∫ø t∆∞ b·∫£n",
      "Quan h·ªá h√¥n nh√¢n t·ª± nguy·ªán, ti·∫øn b·ªô",
      "Quan h·ªá √°p ƒë·∫∑t truy·ªÅn th·ªëng"
    ],
    a: 2
  },
  {
    t: "Nguy√™n t·∫Øc c∆° b·∫£n c·ªßa h√¥n nh√¢n trong x√£ h·ªôi XHCN l√† g√¨?",
    o: [
      "Cha m·∫π quy·∫øt ƒë·ªãnh",
      "M√¥n ƒëƒÉng h·ªô ƒë·ªëi",
      "T·ª± nguy·ªán, ti·∫øn b·ªô, m·ªôt v·ª£ m·ªôt ch·ªìng",
      "L·ª£i √≠ch kinh t·∫ø"
    ],
    a: 2
  },
  {
    t: "Vai tr√≤ c·ªßa gia ƒë√¨nh ƒë·ªëi v·ªõi x√£ h·ªôi l√† g√¨?",
    o: [
      "Ch·ªâ ph·ª•c v·ª• ƒë·ªùi s·ªëng c√° nh√¢n",
      "L√† n∆°i ti√™u d√πng",
      "L√† m√¥i tr∆∞·ªùng h√¨nh th√†nh nh√¢n c√°ch",
      "Kh√¥ng ·∫£nh h∆∞·ªüng x√£ h·ªôi"
    ],
    a: 2
  },
  {
    t: "Trong th·ªùi k·ª≥ qu√° ƒë·ªô, gia ƒë√¨nh ch·ªãu t√°c ƒë·ªông m·∫°nh m·∫Ω t·ª´ y·∫øu t·ªë n√†o?",
    o: [
      "Phong t·ª•c c·ªï truy·ªÅn",
      "Bi·∫øn ƒë·ªïi kinh t·∫ø ‚Äì x√£ h·ªôi",
      "T√≠n ng∆∞·ª°ng t√¥n gi√°o",
      "Thi√™n nhi√™n"
    ],
    a: 1
  },
  {
    t: "B√¨nh ƒë·∫≥ng gi·ªõi trong gia ƒë√¨nh XHCN th·ªÉ hi·ªán ·ªü ƒëi·ªÉm n√†o?",
    o: [
      "Nam gi·ªõi quy·∫øt ƒë·ªãnh m·ªçi vi·ªác",
      "N·ªØ gi·ªõi ph·ª• thu·ªôc",
      "V·ª£ ch·ªìng b√¨nh ƒë·∫≥ng v·ªÅ quy·ªÅn v√† nghƒ©a v·ª•",
      "Con c√°i quy·∫øt ƒë·ªãnh"
    ],
    a: 2
  },
  {
    t: "Gia ƒë√¨nh l√† c·∫ßu n·ªëi gi·ªØa c√° nh√¢n v·ªõi y·∫øu t·ªë n√†o?",
    o: [
      "Nh√† n∆∞·ªõc",
      "X√£ h·ªôi",
      "Th·ªã tr∆∞·ªùng",
      "Doanh nghi·ªáp"
    ],
    a: 1
  },
  {
    t: "M·ªôt trong nh·ªØng v·∫•n ƒë·ªÅ n·ªïi b·∫≠t c·ªßa gia ƒë√¨nh hi·ªán nay l√† g√¨?",
    o: [
      "Gia ƒë√¨nh qu√° ƒë√¥ng con",
      "B·∫°o l·ª±c gia ƒë√¨nh",
      "Kh√¥ng c√≥ h√¥n nh√¢n",
      "X√≥a b·ªè gia ƒë√¨nh"
    ],
    a: 1
  },
  {
    t: "Gi√°o d·ª•c trong gia ƒë√¨nh c√≥ vai tr√≤ g√¨?",
    o: [
      "Kh√¥ng quan tr·ªçng",
      "Ch·ªâ b·ªï tr·ª£ cho nh√† tr∆∞·ªùng",
      "ƒê·∫∑t n·ªÅn t·∫£ng h√¨nh th√†nh nh√¢n c√°ch",
      "Thay th·∫ø gi√°o d·ª•c x√£ h·ªôi"
    ],
    a: 2
  },
  {
    t: "Gia ƒë√¨nh truy·ªÅn th·ªëng v√† gia ƒë√¨nh hi·ªán ƒë·∫°i kh√°c nhau ch·ªß y·∫øu ·ªü ƒë√¢u?",
    o: [
      "S·ªë l∆∞·ª£ng th√†nh vi√™n",
      "Quan h·ªá b√¨nh ƒë·∫≥ng v√† d√¢n ch·ªß",
      "Kh√¥ng gian s·ªëng",
      "Thu nh·∫≠p"
    ],
    a: 1
  },
  {
    t: "Nh√† n∆∞·ªõc XHCN c·∫ßn l√†m g√¨ ƒë·ªÉ x√¢y d·ª±ng gia ƒë√¨nh ti·∫øn b·ªô?",
    o: [
      "Kh√¥ng can thi·ªáp",
      "Ban h√†nh ch√≠nh s√°ch b·∫£o v·ªá gia ƒë√¨nh",
      "X√≥a b·ªè m√¥ h√¨nh gia ƒë√¨nh",
      "Giao cho th·ªã tr∆∞·ªùng"
    ],
    a: 1
  },
  {
    t: "Gia ƒë√¨nh h·∫°t nh√¢n l√† g√¨?",
    o: [
      "Gia ƒë√¨nh nhi·ªÅu th·∫ø h·ªá",
      "Gia ƒë√¨nh ch·ªâ c√≥ cha m·∫π v√† con c√°i",
      "Gia ƒë√¨nh d√≤ng h·ªç",
      "Gia ƒë√¨nh t·∫≠p th·ªÉ"
    ],
    a: 1
  },
  {
    t: "S·ª± bi·∫øn ƒë·ªïi ch·ª©c nƒÉng kinh t·∫ø c·ªßa gia ƒë√¨nh th·ªÉ hi·ªán ·ªü ƒë√¢u?",
    o: [
      "Gia ƒë√¨nh kh√¥ng s·∫£n xu·∫•t",
      "Gia ƒë√¨nh chuy·ªÉn t·ª´ s·∫£n xu·∫•t sang ti√™u d√πng",
      "Gia ƒë√¨nh ch·ªâ l√†m n√¥ng",
      "Gia ƒë√¨nh kh√¥ng c·∫ßn thu nh·∫≠p"
    ],
    a: 1
  },
  {
    t: "Gia ƒë√¨nh c√≥ vai tr√≤ g√¨ trong gi·ªØ g√¨n b·∫£n s·∫Øc vƒÉn h√≥a?",
    o: [
      "Kh√¥ng c√≥ vai tr√≤",
      "L√† n∆°i l∆∞u gi·ªØ v√† truy·ªÅn th·ª• vƒÉn h√≥a",
      "Ch·ªâ ph·ª•c v·ª• c√° nh√¢n",
      "Thay th·∫ø nh√† n∆∞·ªõc"
    ],
    a: 1
  },
  {
    t: "B·∫°o l·ª±c gia ƒë√¨nh ph·∫£n √°nh ƒëi·ªÅu g√¨?",
    o: [
      "S·ª± ti·∫øn b·ªô x√£ h·ªôi",
      "M√¢u thu·∫´n kinh t·∫ø",
      "S·ª± suy tho√°i gi√° tr·ªã gia ƒë√¨nh",
      "Quy lu·∫≠t t·ª± nhi√™n"
    ],
    a: 2
  },
  {
    t: "Trong gia ƒë√¨nh XHCN, tr·∫ª em ƒë∆∞·ª£c xem l√† g√¨?",
    o: [
      "T√†i s·∫£n c·ªßa cha m·∫π",
      "ƒê·ªëi t∆∞·ª£ng b·ªã qu·∫£n l√Ω",
      "Ch·ªß th·ªÉ c√≥ quy·ªÅn",
      "Ngu·ªìn lao ƒë·ªông"
    ],
    a: 2
  },
  {
    t: "Gia ƒë√¨nh g√≥p ph·∫ßn ·ªïn ƒë·ªãnh x√£ h·ªôi th√¥ng qua y·∫øu t·ªë n√†o?",
    o: [
      "Gi√°o d·ª•c ƒë·∫°o ƒë·ª©c",
      "Ki·ªÉm so√°t kinh t·∫ø",
      "Qu·∫£n l√Ω h√†nh ch√≠nh",
      "C∆∞·ª°ng ch·∫ø ph√°p lu·∫≠t"
    ],
    a: 0
  },
  {
    t: "M·ªôt trong nh·ªØng th√°ch th·ª©c c·ªßa gia ƒë√¨nh hi·ªán ƒë·∫°i l√† g√¨?",
    o: [
      "Kho·∫£ng c√°ch th·∫ø h·ªá",
      "Qu√° ƒë√¥ng th√†nh vi√™n",
      "Thi·∫øu nh√† n∆∞·ªõc",
      "Kh√¥ng c√≥ ph√°p lu·∫≠t"
    ],
    a: 0
  },
  {
    t: "Gia ƒë√¨nh trong th·ªùi k·ª≥ qu√° ƒë·ªô mang t√≠nh ch·∫•t g√¨?",
    o: [
      "Thu·∫ßn truy·ªÅn th·ªëng",
      "Thu·∫ßn hi·ªán ƒë·∫°i",
      "V·ª´a truy·ªÅn th·ªëng v·ª´a hi·ªán ƒë·∫°i",
      "Kh√¥ng ·ªïn ƒë·ªãnh"
    ],
    a: 2
  },
  {
    t: "Quan h·ªá gi·ªØa gia ƒë√¨nh v√† x√£ h·ªôi l√† quan h·ªá g√¨?",
    o: [
      "ƒê·ªëi l·∫≠p",
      "T√°ch r·ªùi",
      "Bi·ªán ch·ª©ng, t√°c ƒë·ªông qua l·∫°i",
      "Kh√¥ng li√™n quan"
    ],
    a: 2
  },
  {
    t: "Vai tr√≤ c·ªßa ph·ª• n·ªØ trong gia ƒë√¨nh XHCN ƒë∆∞·ª£c kh·∫≥ng ƒë·ªãnh nh∆∞ th·∫ø n√†o?",
    o: [
      "Ph·ª• thu·ªôc nam gi·ªõi",
      "B√¨nh ƒë·∫≥ng v√† tham gia quy·∫øt ƒë·ªãnh",
      "Ch·ªâ l√†m n·ªôi tr·ª£",
      "Kh√¥ng c√≥ vai tr√≤"
    ],
    a: 1
  },
  {
    t: "Gia ƒë√¨nh l√† m√¥i tr∆∞·ªùng ƒë·∫ßu ti√™n c·ªßa qu√° tr√¨nh n√†o?",
    o: [
      "Lao ƒë·ªông",
      "Gi√°o d·ª•c",
      "X√£ h·ªôi h√≥a c√° nh√¢n",
      "Ch√≠nh tr·ªã h√≥a"
    ],
    a: 2
  },
  {
    t: "Gia ƒë√¨nh XHCN h∆∞·ªõng t·ªõi gi√° tr·ªã n√†o?",
    o: [
      "Gia tr∆∞·ªüng",
      "B·∫•t b√¨nh ƒë·∫≥ng",
      "No ·∫•m, ti·∫øn b·ªô, h·∫°nh ph√∫c",
      "Ph√¢n bi·ªát gi·ªõi"
    ],
    a: 2
  },
  {
    t: "S·ª± thay ƒë·ªïi m√¥ h√¨nh gia ƒë√¨nh ph·∫£n √°nh ƒëi·ªÅu g√¨?",
    o: [
      "S·ª± suy tho√°i x√£ h·ªôi",
      "S·ª± ph√°t tri·ªÉn c·ªßa l·ª±c l∆∞·ª£ng s·∫£n xu·∫•t",
      "S·ª± m·∫•t ·ªïn ƒë·ªãnh ch√≠nh tr·ªã",
      "S·ª± ng·∫´u nhi√™n"
    ],
    a: 1
  },
  {
    t: "Gia ƒë√¨nh c√≥ vai tr√≤ g√¨ trong vi·ªác h√¨nh th√†nh nh√¢n c√°ch?",
    o: [
      "Th·ª© y·∫øu",
      "Quy·∫øt ƒë·ªãnh ban ƒë·∫ßu",
      "Kh√¥ng li√™n quan",
      "Thay th·∫ø x√£ h·ªôi"
    ],
    a: 1
  },
  {
    t: "Ch√≠nh s√°ch gia ƒë√¨nh c·ªßa Nh√† n∆∞·ªõc XHCN nh·∫±m m·ª•c ti√™u g√¨?",
    o: [
      "Ki·ªÉm so√°t d√¢n s·ªë",
      "Ph√°t tri·ªÉn kinh t·∫ø",
      "X√¢y d·ª±ng gia ƒë√¨nh b·ªÅn v·ªØng",
      "X√≥a b·ªè gia ƒë√¨nh"
    ],
    a: 2
  },
  {
    t: "Gia ƒë√¨nh v√† nh√† tr∆∞·ªùng c√≥ m·ªëi quan h·ªá nh∆∞ th·∫ø n√†o?",
    o: [
      "ƒê·ªëi l·∫≠p",
      "Thay th·∫ø nhau",
      "B·ªï sung v√† h·ªó tr·ª£ nhau",
      "Kh√¥ng li√™n quan"
    ],
    a: 2
  },
  {
    t: "Gia ƒë√¨nh g√≥p ph·∫ßn t√°i s·∫£n xu·∫•t x√£ h·ªôi ·ªü kh√≠a c·∫°nh n√†o?",
    o: [
      "T√°i s·∫£n xu·∫•t c·ªßa c·∫£i",
      "T√°i s·∫£n xu·∫•t con ng∆∞·ªùi",
      "T√°i s·∫£n xu·∫•t quy·ªÅn l·ª±c",
      "T√°i s·∫£n xu·∫•t ph√°p lu·∫≠t"
    ],
    a: 1
  },
  {
    t: "Gia ƒë√¨nh XHCN ƒë∆∞·ª£c x√¢y d·ª±ng theo h∆∞·ªõng n√†o?",
    o: [
      "Kh√©p k√≠n",
      "B√¨nh ƒë·∫≥ng, d√¢n ch·ªß, ti·∫øn b·ªô",
      "Gia tr∆∞·ªüng",
      "Ph√¢n t·∫ßng giai c·∫•p"
    ],
    a: 1
  }
];

let teams = [
    { name: "ƒê·ªôi 1", score: 0, effects: { immune: false, x2: false, attack: false, steal_turn: false } },
    { name: "ƒê·ªôi 2", score: 0, effects: { immune: false, x2: false, attack: false, steal_turn: false } },
    { name: "ƒê·ªôi 3", score: 0, effects: { immune: false, x2: false, attack: false, steal_turn: false } },
    { name: "ƒê·ªôi 4", score: 0, effects: { immune: false, x2: false, attack: false, steal_turn: false } },
    { name: "ƒê·ªôi 5", score: 0, effects: { immune: false, x2: false, attack: false, steal_turn: false } }
];

let currentQ = 0;
let isSpinning = false;
let wheelAngle = 0;
let nextQuestionOnSpin = false; // if true, next spin will advance to the next question automatically

/** LOGIC V√íNG QUAY **/
const canvas = document.getElementById("wheel");
const ctx = canvas.getContext("2d");

function drawWheel() {
    const n = CELLS.length;
    const slice = (Math.PI * 2) / n;
    ctx.clearRect(0, 0, 700, 700);
    CELLS.forEach((cell, i) => {
        const a = wheelAngle + i * slice;
        ctx.beginPath(); ctx.moveTo(350, 350);
        ctx.arc(350, 350, 340, a, a + slice);
        ctx.fillStyle = cell.color; ctx.fill();
        ctx.strokeStyle = "white"; ctx.stroke();
        ctx.save(); ctx.translate(350, 350); ctx.rotate(a + slice/2);
        ctx.textAlign = "right"; ctx.fillStyle = "white"; ctx.font = "bold 20px Arial";
        ctx.fillText(cell.label, 320, 10); ctx.restore();
    });
    // Kim ch·ªâ
    ctx.fillStyle = "white"; ctx.beginPath();
    ctx.moveTo(680, 350); ctx.lineTo(700, 330); ctx.lineTo(700, 370); ctx.fill();
}

document.getElementById("btnSpin").onclick = () => {
    if(isSpinning) return;
    isSpinning = true;
    let duration = 4000;
    let start = performance.now();
    let spinAngle = Math.random() * 360 + 1440;
    
    function animate(now) {
        let p = Math.min((now - start) / duration, 1);
        let ease = 1 - Math.pow(1 - p, 3);
        wheelAngle = (ease * spinAngle * Math.PI) / 180;
        drawWheel();
        if(p < 1) requestAnimationFrame(animate);
        else {
            isSpinning = false;
            let n = CELLS.length;
            let slice = (Math.PI * 2) / n;
            let norm = (Math.PI * 2 - (wheelAngle % (Math.PI * 2))) % (Math.PI * 2);
            let idx = Math.floor(norm / slice);
            document.getElementById("resultDisplay").innerText = "K·∫æT QU·∫¢: " + CELLS[idx].label;
            addLog("Quay v√†o √¥: " + CELLS[idx].label);
            // If an answer was revealed previously, advance to next question on this spin
            if(nextQuestionOnSpin) {
                currentQ = Math.min(QUESTIONS.length - 1, currentQ + 1);
                nextQuestionOnSpin = false;
            }
            // T·ª± ƒë·ªông hi·ªÉn th·ªã popup c√¢u h·ªèi
            showQuestionModal();
        }
    }
    requestAnimationFrame(animate);
};

/** LOGIC ƒêI·ªÄU H∆Ø·ªöNG **/
function showPage(id) {
    document.querySelectorAll('.page').forEach(p => p.classList.remove('active'));
    document.querySelectorAll('nav button').forEach(b => b.classList.remove('active'));
    document.getElementById('page-' + id).classList.add('active');
    document.getElementById('btn-' + id).classList.add('active');
    if(id === 'teams') renderTeams();
    if(id === 'questions') renderQuestion();
}

/** LOGIC B·∫¢NG ƒêI·ªÇM **/
function renderTeams() {
    const list = document.getElementById("teamsList");
    list.innerHTML = "";
    teams.forEach((t, i) => {
        const effects = t.effects;
        let effectBadges = '';
        if(effects.immune) effectBadges += '<span class="effect-badge">üõ°Ô∏è Mi·ªÖn</span>';
        if(effects.x2) effectBadges += '<span class="effect-badge">‚úñÔ∏è 2x</span>';
        if(effects.attack) effectBadges += '<span class="effect-badge">‚öîÔ∏è T·∫•n c√¥ng</span>';
        if(effects.steal_turn) effectBadges += '<span class="effect-badge">üè¥ C∆∞·ªõp l∆∞·ª£t</span>';
        
        list.innerHTML += `
            <div class="team-card">
                <h2>${t.name}</h2>
                <div class="score-big" id="score-${i}">${t.score}</div>
                <div style="margin: 15px 0; display: flex; gap: 8px; justify-content: center;">
                    <button class="btn-score" onclick="updateScore(${i}, 10)">+10</button>
                    <button class="btn-score" onclick="updateScore(${i}, -10)">-10</button>
                    <button class="btn-score" onclick="updateScore(${i}, 20)">+20</button>
                </div>
                <div class="effects-section">
                    <h4>‚ö° HI·ªÜU ·ª®NG</h4>
                    <div class="effects-grid">
                        <button class="effect-btn ${effects.immune ? 'active' : ''}" onclick="toggleEffect(${i}, 'immune')">üõ°Ô∏è Mi·ªÖn</button>
                        <button class="effect-btn ${effects.x2 ? 'active' : ''}" onclick="toggleEffect(${i}, 'x2')">‚úñÔ∏è 2x</button>
                        <button class="effect-btn ${effects.attack ? 'active' : ''}" onclick="toggleEffect(${i}, 'attack')">‚öîÔ∏è T·∫•n c√¥ng</button>
                        <button class="effect-btn ${effects.steal_turn ? 'active' : ''}" onclick="toggleEffect(${i}, 'steal_turn')">üè¥ C∆∞·ªõp l∆∞·ª£t</button>
                    </div>
                    ${effectBadges ? `<div style="margin-top: 10px;">${effectBadges}</div>` : ''}
                </div>
            </div>
        `;
    });
}

function updateScore(idx, val) {
    teams[idx].score += val;
    addLog(`${teams[idx].name} thay ƒë·ªïi ${val} ƒëi·ªÉm ‚Üí T·ªïng: ${teams[idx].score}`);
    renderTeams();
}

function toggleEffect(idx, effect) {
    teams[idx].effects[effect] = !teams[idx].effects[effect];
    const effectNames = {
        'immune': 'Mi·ªÖn nhi·ªÖm',
        'x2': 'Nh√¢n ƒë√¥i ƒëi·ªÉm',
        'attack': 'T·∫•n c√¥ng',
        'steal_turn': 'C∆∞·ªõp l∆∞·ª£t'
    };
    const action = teams[idx].effects[effect] ? 'K√çCH HO·∫†T' : 'H·ª¶Y';
    addLog(`${teams[idx].name} ${action} hi·ªáu ·ª©ng: ${effectNames[effect]}`);
    renderTeams();
}

/** LOGIC C√ÇU H·ªéI **/
function renderQuestion() {
    const q = QUESTIONS[currentQ];
    document.getElementById("qNum").innerText = `C√¢u h·ªèi s·ªë ${currentQ + 1} / ${QUESTIONS.length}`;
    document.getElementById("qText").innerText = q.t;
    const optDiv = document.getElementById("qOptions");
    optDiv.innerHTML = "";
    q.o.forEach((o, i) => {
        optDiv.innerHTML += `<div class="opt" id="opt-${i}">${String.fromCharCode(65+i)}. ${o}</div>`;
    });
}

function revealAnswer() {
    const correctIdx = QUESTIONS[currentQ].a;
    document.getElementById(`opt-${correctIdx}`).classList.add('correct');
    addLog(`ƒê√£ m·ªü ƒë√°p √°n c√¢u ${currentQ + 1}`);
}

function changeQ(dir) {
    currentQ = Math.max(0, Math.min(QUESTIONS.length - 1, currentQ + dir));
    renderQuestion();
}

function addLog(m) {
    const l = document.getElementById("log");
    l.innerHTML = `<div>‚Ä¢ ${m}</div>` + l.innerHTML;
}

function resetGame() {
    if(confirm("B·∫°n mu·ªën reset l·∫°i to√†n b·ªô ƒëi·ªÉm s·ªë?")) {
        teams.forEach(t => {
            t.score = 0;
            t.effects = { immune: false, x2: false, attack: false, steal_turn: false };
        });
        currentQ = 0;
        addLog("üîÑ ƒê√É RESET GAME - T·∫•t c·∫£ ƒëi·ªÉm s·ªë v√† hi·ªáu ·ª©ng v·ªÅ 0");
        renderTeams();
    }
}

/** LOGIC MODAL POPUP C√ÇU H·ªéI **/
function showQuestionModal() {
    renderQuestionModal();
    document.getElementById("questionModal").classList.add("show");
    // prevent background scroll while modal open
    document.body.style.overflow = 'hidden';
}

function closeQuestionModal() {
    // stop any running timer and restore body scroll
    stopModalTimer();
    document.getElementById("questionModal").classList.remove("show");
    document.body.style.overflow = '';
}

function renderQuestionModal() {
    const q = QUESTIONS[currentQ];
    document.getElementById("modalQNum").innerText = `C√¢u h·ªèi s·ªë ${currentQ + 1} / ${QUESTIONS.length}`;
    document.getElementById("modalQText").innerText = q.t;
    const optDiv = document.getElementById("modalQOptions");
    optDiv.innerHTML = "";
    q.o.forEach((o, i) => {
        optDiv.innerHTML += `<div class="modal-opt" id="modalOpt-${i}">${String.fromCharCode(65+i)}. ${o}</div>`;
    });
    // reset timer/UI state
    const timerDisplay = document.getElementById('modalTimerDisplay');
    if(timerDisplay) timerDisplay.innerText = 10;
    const startBtn = document.getElementById('modalStartBtn'); if(startBtn) { startBtn.disabled = false; startBtn.style.opacity = ''; }
    const nextBtn = document.getElementById('modalNextBtn'); if(nextBtn) nextBtn.disabled = false;
    const revealBtn = document.getElementById('modalRevealBtn'); if(revealBtn) revealBtn.disabled = false;
    // remove previous answer highlight
    q.o.forEach((o, i) => { const el = document.getElementById(`modalOpt-${i}`); if(el) el.classList.remove('correct'); });
}

let modalTimerInterval = null;
let modalTimeLeft = 0;

function startModalTimer() {
    // reset any running timer
    stopModalTimer();
    modalTimeLeft = 10;
    const display = document.getElementById('modalTimerDisplay'); if(display) display.innerText = modalTimeLeft;
    const startBtn = document.getElementById('modalStartBtn'); if(startBtn) startBtn.disabled = true;
    const nextBtn = document.getElementById('modalNextBtn'); if(nextBtn) nextBtn.disabled = true;

    modalTimerInterval = setInterval(() => {
        modalTimeLeft--;
        const display = document.getElementById('modalTimerDisplay'); if(display) display.innerText = modalTimeLeft;
        if(modalTimeLeft <= 0) {
            stopModalTimer();
            revealAnswerModal();
        }
    }, 1000);
}

function stopModalTimer() {
    if(modalTimerInterval) {
        clearInterval(modalTimerInterval);
        modalTimerInterval = null;
    }
    const startBtn = document.getElementById('modalStartBtn'); if(startBtn) { startBtn.disabled = false; startBtn.style.opacity = ''; }
    const nextBtn = document.getElementById('modalNextBtn'); if(nextBtn) nextBtn.disabled = false;
}

function revealAnswerModal() {
    // stop timer if running
    stopModalTimer();
    const correctIdx = QUESTIONS[currentQ].a;
    const el = document.getElementById(`modalOpt-${correctIdx}`);
    if(el) el.classList.add('correct');
    addLog(`ƒê√£ m·ªü ƒë√°p √°n c√¢u ${currentQ + 1}`);
    // mark that next spin should move to next question automatically
    nextQuestionOnSpin = true;
    // enable next
    const nextBtn = document.getElementById('modalNextBtn'); if(nextBtn) nextBtn.disabled = false;
}

function nextQuestionModal() {
    currentQ = Math.min(QUESTIONS.length - 1, currentQ + 1);
    nextQuestionOnSpin = false; // user advanced manually, cancel pending auto-advance
    renderQuestionModal();
}

function prevQuestionModal() {
    currentQ = Math.max(0, currentQ - 1);
    renderQuestionModal();
}

// ƒê√≥ng modal khi b·∫•m ESC
document.addEventListener("keydown", (e) => {
    if(e.key === "Escape") {
        const modal = document.getElementById("questionModal");
        if(modal && modal.classList.contains("show")) {
            closeQuestionModal();
        }
    }
});

// Kh·ªüi t·∫°o l·∫ßn ƒë·∫ßu
drawWheel();
renderTeams();
</script>

</body>
</html>